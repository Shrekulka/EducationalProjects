# 1. loging.py

## Назначение:
Этот скрипт предназначен для автоматизированного входа на веб-сайт с использованием Selenium WebDriver. 
Он демонстрирует процесс аутентификации на сайте и получения содержимого страницы после успешного входа.

## Последовательность работы:
1. Инициализация драйвера с помощью функции setup_driver() из модуля common.
2. Открытие страницы логина, указанной в конфигурации.
3. Ожидание загрузки элемента ввода имени пользователя.
4. Поиск элементов формы логина (поля имени пользователя, пароля и кнопки входа).
5. Ввод учетных данных из конфигурации.
6. Нажатие кнопки входа.
7. Ожидание загрузки страницы после входа.
8. Получение и логирование исходного кода страницы.
9. Обработка возможных исключений.
10. Закрытие веб-драйвера.

## Особенности:
- Использует модуль logging для подробного логирования действий и ошибок.
- Применяет явные ожидания (WebDriverWait) для повышения надежности скрипта.
- Обрабатывает исключения и выводит подробную информацию об ошибках.
- Использует конфигурационный файл для хранения настроек.

## Настройки (config.py):
Файл config.py использует библиотеку pydantic для создания и валидации конфигурационных данных. 
Pydantic - это мощная библиотека для работы с данными в Python, которая обеспечивает проверку типов данных во время 
выполнения и предоставляет удобный способ работы с настройками приложения.

1. *URL страницы логина (login_url):*
    ```bash
    pythonCopylogin_url: str = 'https://quotes.toscrape.com/login'
    ```
    Это адрес веб-страницы, на которой находится форма входа. Скрипт будет использовать этот URL для перехода на 
    страницу аутентификации.

2. *Имя пользователя и пароль:*
    ```bash
    pythonCopyusername: str
    password: SecretStr
    ```
    Эти поля предназначены для хранения учетных данных. Обратите внимание, что пароль хранится как SecretStr - это 
    специальный тип данных pydantic, который обеспечивает дополнительную безопасность, скрывая значение пароля при 
    выводе или логировании.

3. *Путь к geckodriver:*
    ```bash
    pythonCopygeckodriver_path: str = './geckodriver'
    ```
    Это путь к исполняемому файлу geckodriver, который необходим для работы Selenium с браузером Firefox. Geckodriver - 
    это драйвер, который позволяет Selenium взаимодействовать с Firefox.

4. *Параметры настройки веб-драйвера:*
    ```bash
    pythonCopyheadless_mode: bool = True
    disable_cache: bool = True
    tracking_protection: bool = True
    custom_user_agent: str = 'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:88.0) Gecko/20100101 Firefox/88.0'
    ```
      - headless_mode: Если True, браузер запускается в фоновом режиме без графического интерфейса, что полезно для 
        автоматизации и работы на серверах.
      - disable_cache: Если True, отключает кэширование браузера, что может быть полезно для получения актуальных данных
        при каждом запросе.
      - tracking_protection: Если True, включает защиту от отслеживания в браузере.
      - custom_user_agent: Позволяет установить пользовательский User-Agent, который может помочь в обходе некоторых 
        ограничений сайтов.


5. *Дополнительные настройки:*
    ```bash
    pythonCopyinfinite_scroll_url: str = 'https://quotes.toscrape.com/scroll'
    min_pause_time: float = 1.2
    max_pause_time: float = 2.5
    ```
    - infinite_scroll_url: URL страницы с бесконечной прокруткой для скрипта infinite_scroll_scraper.py.
    - min_pause_time и max_pause_time: Определяют диапазон времени для случайных пауз между действиями, что помогает 
      имитировать поведение человека и избежать блокировки со стороны сайта.


6. *Загрузка настроек из файла окружения:*
    ```bash
    class Config:
        env_file = ".env"
        env_file_encoding = "utf-8"
    ```
    Эта конфигурация позволяет загружать значения из файла .env, что является безопасным способом хранения 
    конфиденциальных данных, таких как пароли и ключи API.

#### Использование pydantic для конфигурации предоставляет несколько преимуществ:
- Автоматическая валидация типов данных.
- Возможность задать значения по умолчанию.
- Легкая загрузка данных из переменных окружения или файлов .env.
- Безопасное хранение секретных данных с использованием SecretStr.

## Настройка веб-драйвера (common.py): 
Файл common.py содержит функцию setup_driver(), которая отвечает за настройку и инициализацию веб-драйвера Firefox с 
расширенными опциями. Эта функция играет ключевую роль в подготовке браузера для выполнения задач веб-скрапинга.

### Основные компоненты и настройки:
1. *Инициализация Service и Options:*
    ```bash
    service = Service(config.geckodriver_path)
    options = Options()
    ```
    - Service используется для указания пути к geckodriver.
    - Options позволяет настроить поведение браузера.

2. *Настройка режима работы:*
    ```bash
    if config.headless_mode:
        options.add_argument('-headless')
    ```
    Headless режим позволяет запускать браузер без графического интерфейса, что полезно для автоматизации и работы на
    серверах.

3. *Настройки безопасности и стабильности:*
    ```bash
    options.add_argument('-no-sandbox')
    options.add_argument('-disable-dev-shm-usage')
    ```
    Эти настройки повышают стабильность работы браузера, особенно в контейнеризированных средах.

4. *Управление кэшированием:*
    ```bash
    if config.disable_cache:
        options.set_preference('browser.cache.disk.enable', False)
        options.set_preference('browser.cache.memory.enable', False)
        # ...
    ```
    Отключение кэша может быть полезно для получения актуальных данных при каждом запросе.

5. *Настройки приватности:*
    ```bash
    if config.tracking_protection:
        options.set_preference('privacy.trackingprotection.enabled', True)
        options.set_preference('privacy.donottrackheader.enabled', True)
    ```
    Эти настройки повышают приватность при веб-скрапинге.

6. *Отключение уведомлений и всплывающих окон:*
    ```bash
    options.set_preference('dom.webnotifications.enabled', False)
    options.set_preference('dom.push.enabled', False)
    options.set_preference('dom.disable_open_during_load', True)
    ```
    Эти настройки предотвращают появление нежелательных элементов, которые могут помешать скрапингу.

7. *Оптимизация производительности:*
    ```bash
    options.set_preference('browser.tabs.remote.autostart', False)
    options.set_preference('media.autoplay.default', 0)
    options.set_preference('webgl.disabled', True)
    ```
    Эти настройки помогают снизить использование ресурсов и повысить производительность.

8. *Настройка User-Agent:*
    ```bash
    if config.custom_user_agent:
        options.set_preference('general.useragent.override', config.custom_user_agent)
    ```
    Установка пользовательского User-Agent может помочь в обходе некоторых ограничений сайтов.

9. *Локализация:*
    ```bash
    options.set_preference('intl.accept_languages', 'ru-RU,ru')
    options.set_preference('general.useragent.locale', 'ru-RU')
    ```
    Эти настройки имитируют поведение браузера с русской локализацией.

10. *Создание и возврат веб-драйвера:*
    ```bash
    return webdriver.Firefox(service=service, options=options)
    ```
    Функция возвращает полностью настроенный объект веб-драйвера Firefox.

Использование common.py позволяет централизовать настройки веб-драйвера, что обеспечивает согласованность конфигурации 
между разными скриптами (loging.py и infinite_scroll_scraper.py). Это упрощает поддержку и модификацию настроек, так 
как все изменения могут быть сделаны в одном месте.

# 2. infinite_scroll_scraper.py

## Назначение:
Этот скрипт разработан для скрапинга веб-страниц с бесконечной прокруткой. Он автоматически прокручивает страницу до тех
пор, пока не будет загружен весь контент, а затем подсчитывает количество загруженных элементов.

## Последовательность работы:
1. Инициализация драйвера с помощью функции setup_driver() из модуля common.
2. Открытие страницы с бесконечной прокруткой, указанной в конфигурации.
3. Ожидание загрузки первого элемента на странице.
4. Циклическая прокрутка страницы:
   - Прокрутка до конца текущей страницы.
   - Пауза для загрузки нового контента.
   - Проверка, изменилась ли высота страницы (признак новых данных).
5. Подсчет количества загруженных элементов.
6. Логирование результатов.
7. Обработка возможных исключений.
8. Закрытие веб-драйвера.

## Особенности:
- Использует случайные паузы между прокрутками для имитации поведения человека.
- Применяет проверку изменения высоты страницы для определения конца контента.
- Логирует количество загруженных элементов.
- Обрабатывает исключения, включая прерывание пользователем.

## Настройки:
Аналогично loging.py, настройки загружаются из config.py. Дополнительные настройки включают:
- URL страницы с бесконечной прокруткой
- Минимальное и максимальное время паузы между прокрутками

Обе программы используют общий модуль setup_driver() из common.py, который настраивает веб-драйвер Firefox с 
расширенными опциями, такими как headless режим, отключение кэша, настройки приватности и производительности.
Эти скрипты демонстрируют эффективный подход к веб-скрапингу с использованием Selenium, включая обработку аутентификации
и динамически загружаемого контента.

## Структура проекта:

```bash
📁 selenium/                      # Корневая директория проекта
│
├── .env                          # Файл с переменными окружения (логины, пароли)
│
├── .gitignore                    # Файл, указывающий Git, какие файлы/папки игнорировать
│
├── common.py                     # Общие функции, включая настройку веб-драйвера
│
├── config.py                     # Конфигурационный файл с настройками проекта
│
├── geckodriver                   # Исполняемый файл geckodriver для управления Firefox
│
├── infinite_scroll_scraper.py    # Скрипт для скрапинга страниц с бесконечной прокруткой
│
├── logger_config.py              # Конфигурация логгера для проекта
│
├── loging.py                     # Скрипт для автоматизированного входа на сайт
│
├── README.md                     # Документация проекта, инструкции по установке и использованию
│
├── requirements.txt              # Список зависимостей Python для проекта
│
└── 📁 venv/                      # Виртуальное окружение Python (обычно игнорируется в .gitignore)  
```