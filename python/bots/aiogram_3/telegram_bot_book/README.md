# Бот-книга

## Постановка задачи

### Что?
Бот-книга

### Чтобы что?
Чтобы можно было читать книгу прямо в телеграм-боте и попрактиковаться в работе с инлайн-кнопками

### Что бот должен уметь?
1. Загружать страницы книги из хранилища и присылать их в чат в виде сообщений с кнопками
2. Сохранять страницу, на которой остановился пользователь и загружать книгу на этом месте
3. Переходить в начало книги

### Дополнительный функционал
1. Сохранять закладки - страницы книги, которые пользователь пожелал сохранить
2. Редактировать закладки (удалять ненужные)

### Описание взаимодействия с ботом
1. Пользователь отправляет команду /start боту (или стартует его, найдя в поиске).
2. Бот приветствует пользователя, сообщает, что пользователь может прочитать книгу прямо в чате с ботом, а также 
   предлагает пользователю посмотреть список доступных команд, отправив команду /help.
3. На этом этапе пользователь может совершить 5 действий:
    - Отправить в чат команду /help
    - Отправить в чат команду /beginning
    - Отправить в чат команду /continue
    - Отправить в чат команду /bookmarks
    - Отправить в чат любое другое сообщение
4. Пользователь отправляет в чат команду /help:
    - Бот присылает пользователю список доступных команд, сообщает о том, что можно сохранять страницы книги в закладки
      и желает приятного чтения.
5. Пользователь отправляет в чат команду /beginning:
    a) Бот отправляет в чат первую страницу книги и 3 инлайн-кнопки (назад, текущий номер страницы и вперед).
    b) Соответственно, при взаимодействии с сообщением-книгой пользователь может:
     - Нажать на кнопку "Вперед" и тогда бот загрузит следующую страницу книги, если текущая страница не последняя. 
       Номер текущей страницы на кнопке увеличится на 1. А если текущая страница последняя в книге, то ничего не 
       изменится.
     - Нажать на кнопку с текущим номером страницы и тогда бот сохранит эту страницу в закладки, сообщив пользователю 
       об этом.
     - Нажать на кнопку "Назад" и тогда бот загрузит предыдущую страницу книги, если текущая страница не первая. Номер 
       текущей страницы на кнопке уменьшится на 1. А если текущая страница первая, то ничего не изменится.
6. Пользователь отправляет в чат команду /continue:
    - Бот отправляет в чат страницу книги, на которой пользователь остановил чтение во время последнего взаимодействия с
      сообщением-книгой.
    - Если пользователь еще не начинал читать книгу - бот отправляет сообщение с первой страницей книги.
7. Пользователь отправляет в чат команду /bookmarks:
    a) Если пользователь сохранял закладки ранее, то бот отправляет в чат список сохраненных закладок в виде 
       инлайн-кнопок, а также инлайн-кнопки "Редактировать" и "Отменить".
       1) Если пользователь нажимает на кнопку с закладкой - бот отправляет сообщение с книгой на той странице, куда 
          указывала закладка
       2) Если пользователь нажимает на кнопку "Отменить", то бот убирает список закладок и отправляет сообщение с 
          предложением продолжить чтение, отправив команду /continue
       3) Если пользователь нажимает на кнопку "Редактировать", то бот отправляет список сохраненных закладок в виде 
          инлайн-кнопок с пометкой на удаление, а также инлайн-кнопку "Отменить"
          - Если пользователь нажимает на закладку с пометкой на удаление - она пропадает из списка редактируемых 
            закладок
          - Если список содержит хотя бы одну закладку и пользователь нажимает "Отменить" - бот убирает сообщение со 
            списком редактируемых закладок и меняет его на сообщение с предложением продолжить чтение, отправив команду 
            /continue
          - Если в списке, после очередного удаления закладки, не остается ни одной закладки - бот сообщает пользователю, 
            что у него нет ни одной закладки и предлагает продолжить чтение книги, отправив команду /continue
8. Пользователь отправляет в чат любое другое сообщение:
    a) Бот как-то реагирует на такое сообщение, например, эхом


1. ## Вспомогательная функция _get_part_text()
    Перед тем, как отправлять пользователям в чат страницы книги, нужно привести текст книги к удобному для работы 
    формату. Мы будем хранить страницы книги в словаре, где ключом будет номер страницы, а значением - строка с текстом 
    этой страницы, как показано на предыдущем шаге. И прежде, чем написать основную функцию, которая подготовит такой 
    словарь из текстового файла, нам потребуется написать вспомогательную функцию _get_part_text(), которая будет 
    получать на вход текст из файла, указатель на начало страницы в тексте и максимальный размер страницы, которую нужно
    вернуть. А возвращать функция должна текст страницы и ее размер (в символах). При этом, получившаяся страница, 
    обязательно должна заканчиваться на какой-нибудь знак препинания, чтобы текст страницы не обрывался на полуслове.
    
    Реализция функции _get_part_text(), которая принимает три аргумента в следующем порядке:
    
    text - строка с полным текстом, из которого нужно получить страницу не больше заданного размера
    start - номер первого символа в тексте, с которого должна начинаться страница (нумерация идет с нуля)
    page_size - максимальный размер страницы, которая должна получиться на выходе
    Функция должна вернуть текст страницы (тип str) и ее получившийся размер в символах (тип int).
    
    Список знаков препинания, которые могут быть окончанием текста страницы, состоит из знаков:
    
    , - запятая
    . - точка
    ! - восклицательный знак
    : - двоеточие
    ; - точка с запятой
    ? - вопросительный знак
    Примечание 1. Гарантируется, что подаваемый в функцию текст, не пустой, а в тексте страницы обязательно встретятся знаки препинания из списка выше
    
    Примечание 2. Также гарантируется, что стартовый символ будет меньше, чем длина подаваемого в функцию текста.
    
    Примечание 3. Если в тексте встречается многоточие (а также другие сочетания идущих подряд знаков препинания, типа, ?!, ?.., !.. и т.п.) - они либо целиком должны попасть в текущую страницу, либо не попасть в страницу вообще. Нельзя разорвать такую последовательность, потому что следующая страница книги тогда начнется с точки, точек или других знаков препинания, что для пользователя будет смотреться, как неправильное форматирование текста.
    
    Примечание 4. Обрезать невидимые символы (перенос строки, пробел и т.п.), получившиеся слева от текста, не надо. Мы это будем делать внутри следующей функции.
    
    Примечание 5. В тестирующую систему сдайте программу, содержащую только необходимую функцию _get_part_text(), но не код, вызывающий ее.
    
    Sample Input 1:
    
    text = 'Раз. Два. Три. Четыре. Пять. Прием!'
    
    print(*_get_part_text(text, 5, 9), sep='\n')
    Sample Output 1:
    
    Два. Три.
    9
    Sample Input 2:
    
    text = 'Да? Вы точно уверены? Может быть, вам это показалось?.. Ну, хорошо, приходите завтра, тогда и посмотрим, что можно сделать. И никаких возражений! Завтра, значит, завтра!'
    
    print(*_get_part_text(text, 22, 145), sep='\n')
    Sample Output 2:
    
    Может быть, вам это показалось?.. Ну, хорошо, приходите завтра, тогда и посмотрим, что можно сделать. И никаких возражений! Завтра, значит,
    139
    Sample Input 3:
    
    text = '— Я всё очень тщательно проверил, — сказал компьютер, — и со всей определённостью заявляю, что это и есть ответ. Мне кажется, если уж быть с вами абсолютно честным, то всё дело в том, что вы сами не знали, в чём вопрос.'
    
    print(*_get_part_text(text, 54, 70), sep='\n')
    Sample Output 3:
    
    — и со всей определённостью заявляю, что это и есть ответ.
    58

2. ## Функция подготовки книги prepare_book()
    Нам доступен текстовый файл книги book.txt. Нужно написать функцию prepare_book(), которая будет принимать 1 аргумент:
    
    path - строка - путь к файлу с книгой
    
    функция должна будет читать файл book.txt и, с помощью функции _get_part_text(), написанной на предыдущем шаге, 
    преобразовывать его в словарь. Ключами в словаре будут идущие подряд номера страниц, а значениями - тексты этих 
    страниц. То есть, если, например, текст книги будет таким:
    
    Пошлость собственной мечты была так заметна, что Таня понимала: даже мечтать и горевать ей приходится закачанными в 
    голову штампами, и по другому не может быть, потому что через все женские головы на планете давно проложена ржавая 
    узкоколейка, и эти мысли — вовсе не ее собственные надежды, а просто грохочущий у нее в мозгу коммерческий товарняк.
    
    Словно бы на самом деле думала и мечтала не она, а в пустом осеннем сквере горела на стене дома огромная панель, 
    показывая равнодушным жирным воронам рекламу бюджетной косметики.
    При размере страницы PAGE_SIZE = 100, словарь book будет таким:
    
    book = {1: 'Пошлость собственной мечты была так заметна, что Таня понимала:',
            2: 'даже мечтать и горевать ей приходится закачанными в голову штампами, и по-другому не может быть,',
            3: 'потому что через все женские головы на планете давно проложена ржавая узкоколейка,',
            4: 'и эти мысли — вовсе не ее собственные надежды,',
            5: 'а просто грохочущий у нее в мозгу коммерческий товарняк.',
            6: 'Словно бы на самом деле думала и мечтала не она,',
            7: 'а в пустом осеннем сквере горела на стене дома огромная панель,', 
            8: 'показывая равнодушным жирным воронам рекламу бюджетной косметики.'}

    Примечание 1. Функцию prepare_book() вызывать не надо - только написать. Функция не должна ничего возвращать.
    
    Примечание 2. Словарь book создавать не надо - он уже есть, просто заполняйте его.
    
    Примечание 3. Код функции _get_part_text() вставлять не надо. Считайте, что она у вас уже есть и вы можете ее 
                  вызвать, передав ей соответствующие параметры.
    
    Примечание 4. Параметр PAGE_SIZE уже задан, равным 1050, просто используйте его, как переменную, которая объявлена 
                  ранее.
    
    Примечание 5. Перед помещением текста страницы в словарь, удалите лишние символы из начала этого текста. Это мотут 
                  быть пробелы, переводы строк, табуляции и т.п. На всякий случай напоминаю про строковый метод lstrip().
    
    Примечание 6. Текстовый файл book.txt доступен по ссылке. Получающийся словарь по этому тексту доступен по ссылке.
    
    Примечание 7. При открытии файла, явно указывайте кодировку encoding='utf-8'.


Структура проекта:
```bash
📁 Bookbot                                  # Корневая директория всего проекта
 │
 ├── .env                                   # Файл с переменными окружения (секретными данными) для конфигурации бота.
 │
 ├── .env.example                           # Файл с примерами секретов для GitHub
 │
 ├── .gitignore                             # Файл, сообщающий гиту какие файлы и директории не отслеживать
 │
 ├── bot.py                                 # Основной исполняемый файл - точка входа в бот
 │
 ├── requirements.txt                       # Файл с зависимостями проекта.
 │
 ├── logger_config.py                       # Конфигурация логгера.
 │
 ├── README.md                              # Файл с описанием проекта.
 │
 ├── 📁 config_data/                        # Директория с модулем конфигурации бота.
 │   ├── __init__.py                        # Файл-инициализатор пакета. 
 │   └── config_data.py                     # Модуль для конфигурации бота.
 │
 ├── 📁 database/                           # Пакет для работы с базой данных.
 │   ├── __init__.py                        # Файл-инициализатор пакета.     
 │   └── database.py                        # Модуль с шаблоном базы данных.
 │
 ├── 📁 filters/                            # Пакет с пользовательскими фильтрами.
 │   ├── __init__.py                        # Файл-инициализатор пакета.      
 │   └── filters.py                         # Модуль с фильтрами, которые мы напишем для конкретных задач бота.
 │ 
 ├── 📁 handlers/                           # Пакет с обработчиками.
 │   ├── __init__.py                        # Файл-инициализатор пакета.
 │   ├── user_handlers.py                   # Модуль с обработчиками пользователя. Основные обработчики обновлений бота.
 │   └── other_handlers.py                  # Модуль с обработчиком остальных сообщений пользователя.
 │                                                 
 ├── 📁 keyboards/                          # Пакет с клавиатурами бота.
 │   ├── __init__.py                        # Файл-инициализатор пакета.            
 │   ├── bookmarks_kb.py                    # Модуль с клавиатурами для работы с закладками пользователя.
 │   ├── main_menu.py                       # Модуль для формирования главного меню бота.
 │   └── pagination_kb.py                   # Модуль для формирования кнопок пагинации для управления книгой.     
 │ 
 ├── 📁 lexicon/                            # Директория для хранения словарей бота.      
 │   ├── __init__.py                        # Файл-инициализатор пакета.                      
 │   └── lexicon_ru.py                      # Файл со словарем соответствий команд и запросов отображаемым текстам.
 │ 
 └── 📁 services/                           # Директория для вспомогательных инструментов.     
     ├── __init__.py                        # Файл-инициализатор пакета.                       
     └── file_handling.py                   # Модуль для подготовки книги для обработки ботом.      
 ```
Учебный материал на Stepik - https://stepik.org/course/120924/syllabus